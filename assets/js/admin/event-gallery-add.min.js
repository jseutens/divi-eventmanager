jQuery(document).ready(function($){
	$('a.add').click(function(){
		var dpevent_cust_image_id = $('input[name="dpevent_cust_image_id"]').val();
		dpevent_cust_image_id = parseInt(dpevent_cust_image_id) + 1;
		imgDetails = '<div class="postbox clone imgbox-'+dpevent_cust_image_id+'"><div class="handlediv clonedata" title="Click to toggle"><br></div><h3 class="hndle"><span>Image Details:</span></h3><div class="inside" style="margin-left: 20px;"><div class="form-field"><label for="cover_image" class="dpevent_cust_gallery_upload_image">Image</label><div class="cover_image" style="display:none;"><img src="" name="dpevent_cust_gallery_display_cover_image" id="dpevent_cust_gallery_display_cover_image" /></div><p><span><i>Best image size for thumbnail : <strong>263px * 148px</strong> (upload : JPG, PNG & GIF )</i></span></p><input type="hidden" size="36" name="dpevent_cust_gallery_upload_image[]" id="dpevent_cust_gallery_upload_image'+dpevent_cust_image_id+'" value="" /><p><input name="dpevent_cust_gallery_upload_image_button" type="button" value="Upload Image" class="button button-primary" style="margin-right: 2px;"/><input name="dpevent_cust_gallery_remove_image_button" type="button" value="Remove Image"  width="8%" class="button button-primary" style="display:none;"></p></div></div><div class="hr" style="margin-bottom: 10px;"></div><p style="overflow:hidden; padding-right:10px;"><a href="javascript:void(0);" onclick="removebox('+dpevent_cust_image_id+');" class="btn-right button button-remove button-sm">- Remove</a></p></div>';
		
		$('div.imageDetailsClone').prepend(imgDetails);
		$('input[name="dpevent_cust_image_id"]').val(dpevent_cust_image_id);
		manageremove();
		
	});

		var cust_upload_third_loc_file;
		var dpevent_cust_upload_third_locationlabel = 0;
	 	var myval;
		 // Bind to our click event in order to open up the new media experience.
		 $(document.body).on('click.mojoOpenMediaManager', 'input[name="dpevent_cust_gallery_upload_image_button"]', function(e){ 
		 	// Prevent the default action from occuring.
			 e.preventDefault();
			// Get our Parent element
			 dpevent_cust_upload_third_locationlabel = $(this).parent();
			 
			 myval = $(this).parents('.form-field');
			 // If the frame already exists, re-open it.
			 if ( cust_upload_third_loc_file ) {
			 cust_upload_third_loc_file.open();
			 return;
			 }
			 
			 cust_upload_third_loc_file = wp.media.frames.cust_upload_third_loc_file = wp.media({
						 title: "Add Gallery Image",
					     button: {
						  text: "Insert Gallery Image",
					     },
						 editing:    true,
						 className: 'media-frame cust_upload_third_loc_file',
						 frame: 'select', //Allow Select Only
						 multiple: false, //Disallow Mulitple selections
						 library: {
						 type: 'image' //Only allow images type: 'image'
				 },
			});
			
			 cust_upload_third_loc_file.on('select', function(){
			 // Grab our attachment selection and construct a JSON representation of the model.
			 var dpevent_cust_loc_media_attachment = cust_upload_third_loc_file.state().get('selection').first().toJSON();
			 
			 if(dpevent_cust_loc_media_attachment.subtype === "pdf" || dpevent_cust_loc_media_attachment.subtype === "doc" || dpevent_cust_loc_media_attachment.subtype === "docx" || dpevent_cust_loc_media_attachment.subtype === "txt")
			 {
				alert("Please Insert only image");
				return;
			 }
			 
			 var dpevent_cust_thum_url = dpevent_cust_loc_media_attachment.url;
			 var thumb_id = dpevent_cust_loc_media_attachment.id; 
			 
			// Send the attachment URL to our custom input field via jQuery.
			 dpevent_cust_loc_url = dpevent_cust_loc_media_attachment.url;
			 locurls = dpevent_cust_loc_url.substr( (dpevent_cust_loc_url.lastIndexOf('.') +1) );
			
			 if(locurls !=='pdf' && locurls !=='zip' && locurls !=='rar' && locurls !=='txt' && locurls !=='doc' && locurls !=='docx')
			 {
			 	 myval.find('.cover_image').css('display','block');
				 myval.find('input[name="dpevent_cust_gallery_remove_image_button"]').css('display','inline-block');
				 myval.find('input[name="dpevent_cust_gallery_upload_image[]"]').val(thumb_id);
				 myval.find('img[name="dpevent_cust_gallery_display_cover_image"]').attr('src',dpevent_cust_thum_url );
			 }else{
				     alert('Please add only image');
		     }
			 });
	 
			// Now that everything has been set, let's open up the frame.
			 cust_upload_third_loc_file.open();
		 });
		 // extrnal image  upload data
		 		var cust_upload_third_loc_file;
		var dpevent_cust_upload_third_locationlabel = 0;
		 // Bind to our click event in order to open up the new media experience.
		 // image remove process
		 manageremove();
		
	//$('.imageDetailsClone').sortable();
});
function removebox(dpevent_cust_image_id)
{
	jQuery('.imgbox-'+dpevent_cust_image_id).remove();
	totalbox = parseInt(jQuery('input[name="dpevent_cust_image_id"]').val())-1;
	jQuery('input[name="dpevent_cust_image_id"]').val(totalbox);
}
function manageremove()
{
	$ = jQuery; 
	$('input[name="dpevent_cust_gallery_remove_image_button"]').click(function(){
		$(this).parents('.form-field').find('input[name="dpevent__gallery_display_cover_image"]').attr('src','');
		$(this).parents('.form-field').find('input[name="dpevent_cust_gallery_upload_image[]"]').attr('value','');	
		$(this).parents('.form-field').find('.cover_image').css('display','none');
		$(this).parents('.form-field').find('input[name="dpevent__gallery_remove_image_button"]').css('display','none');
	});
	
	$('.clonedata').click(function(){
		$(this).parents('.clone').toggleClass('closed');	
	});
}

jQuery(document).ready(function() {

	jQuery('#post').on('submit', function(){

		// validate 
		var msg='';
		var err=0;
		var dpevent_cust_gallery_image = [];
		
		var dpevent_cust_image_id = jQuery('input[name="dpevent_cust_image_id"]').val();
		dpevent_cust_image_id = parseInt(dpevent_cust_image_id) + 1;
		
		if(dpevent_cust_image_id > 1)
		{
			for(i=0; i<dpevent_cust_image_id; i++)
			{
				gallery_dpevent_cust_image_id = '#dpevent_cust_gallery_upload_image'+i;
				div_exist = jQuery(gallery_dpevent_cust_image_id).length;
				if(div_exist)
					dpevent_cust_gallery_image[i] = jQuery(gallery_dpevent_cust_image_id).val();
			}
		
			for(i=0; i<dpevent_cust_image_id; i++)
			{
				gallery_dpevent_cust_image_id = '#dpevent_cust_gallery_upload_image'+i;
				div_exist = jQuery(gallery_dpevent_cust_image_id).length;
				if( !dpevent_cust_gallery_image[i] && div_exist)
				{
					msg += 'Please upload gallery image \n';
					gallery_dpevent_cust_image_id = '#dpevent_cust_gallery_upload_image'+i;
					jQuery(gallery_dpevent_cust_image_id).addClass('error');
					jQuery('.dpevent_cust_gallery_upload_image').addClass('error');
					err++;
				}
				else
				{
					jQuery(gallery_dpevent_cust_image_id).removeClass('error');
					jQuery('.dpevent_cust_gallery_upload_image').removeClass('error');
				}
			}
		}					
		jQuery('#allerrmsg').remove();
		var posttype=jQuery('#post_type').val();
		if(err!== 0 && posttype === 'post')
		{
			jQuery('#publish').removeClass('disabled');
			jQuery('.spinner').css('display','none');

			var m='<div id="allerrmsg" style="color:red;border:1px solid red;padding:5px;width:73%;margin:1px;">There is some error, Please fill all the mandatory fields. </div>';
			jQuery('.wrap h2').after(m);

			return false;
		}
		else{
			err=0;
			return true;	
		}
	});
});